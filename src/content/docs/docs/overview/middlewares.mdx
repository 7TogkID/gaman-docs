---
title: Middlewares
description: Middleware in GamanJS provides a powerful way to process requests before they reach the route handler. Middleware can be defined globally for all routes in a Block or scoped to specific paths and HTTP methods. Middleware functions are designed to continue to the next handler when they do not return a response.
---


Normalnya **Middleware Gaman** itu terletak di folder `src/middlewares/**` jadi semisal anda memakai `autoComposeMiddleware((ctx, next) => next())` itu akan otomatis di register oleh sistem.

![workflow middleware](/img/workflow/middleware.png)

Middleware disini berperan sebagai guard sistem request, middleware akan di jalankan pertama kali saat request masuk, jadi sebelum `interceptor` lalu `handler`, `middleware` akan di jalankan terlebih dahulu.

## Middleware definition

### `composeMiddleware()`
disini kita memakai `composeMiddleware` yang berarti tidak akan otomatis di register ke data `middlewares` jadi anda harus manual meregister ke `index.ts`

```ts
// AppMiddleware.ts
import { composeMiddleware } from "@gaman/core"

export default composeMiddleware((ctx, next) => {
  return next()
});
```
setelah itu anda harus meregister manual ke file `src/index.ts`
```ts
// index.ts
import { AppMiddleware } from "./middlewares/AppMiddleware.ts"
import { AuthMiddleware } from "./middlewares/AuthMiddleware.ts"

defineBootstrap((app) => {

  app.mountMiddleware(AppMiddleware()) // singgle global middleware

  app.mountMiddleware([AppMiddleware(), AuthMidldeware()]) // multi global middleware
})
```
atau bisa di register ke dalam router tertentu berikut adalah contohnya:
```ts
// AppRoutes.ts
import { AppMiddleware } from "./middlewares/AppMiddleware.ts"
import { AuthMiddleware } from "./middlewares/AuthMiddleware.ts"

export default autoComposeRoutes((route) => {
  route
    .get('/generate-token', Handler)
    .middleware(AppMiddleware()) // single middleware
    .middleware([AppMiddleware(), AuthMiddleware()]) // multi middleware
  
  route.group('/user', (route) => {
    route.post('/create', Handler)
    route.get('/profile', Handler)
  }).middleware(AppMiddleware()) // single middleware
    .middleware([AppMiddleware(), AuthMiddleware()]) // multi middleware
})
```
jika anda menaruh middleware ke group maka routes di dalamnya akan terkena efeknya juga


### `autoComposeMiddleware()`
disini kita memakai `autoComposeMiddleware` yang berarti akan otomatis di register ke data `middlewares` dengan persyaratan harus berada di folder `src/middlewares/**`

```ts
// AppMiddleware.ts
import { autoComposeMiddleware } from "@gaman/core"

export default autoComposeMiddleware((ctx, next) => {
  return next();
})
```
ini akan otomatis di register ke dalam data `middlewares` jadi anda tidak perlu register manual.


## Middleware Config
disini gaman sudah menyiapkan default config bawaan middleware yang bisa kamu pakai

### Priority
`priority` adalah config yang sangat berguna untuk semakin tinggal prioritas nya maka proses akan di jalankan lebih awal dari yang lain

```ts
export default composeMiddleware((ctx, next) => {
  return next();
}, {
  priority: 'normal' // "very-high" | "high" | "normal" | "low" | "very-low"
})
```
### Includes
`includes` disini iyalah berfungsi untuk ngefilter route atau path mana, yang mau menjalankan middleware

```ts
export default composeMiddleware((ctx, next) => {
  return next()
}, {
  inclues: [
    '/user/**',       // Semua route yang diawali /user
    '/setting/*',     // Hanya 1 segmen setelah /setting
    '/dashboard'      // Hanya persis /dashboard
  ]
})
```

### Excludes
`excludes` disini iyalah berfungsi untuk ngefilter route atau path mana, yang tidak akan menjalankan middleware

```ts
export default composeMiddleware((ctx, next) => {
  return next()
}, {
  excludes: [
    '/profile/**',  // Semua route yang diawali /user
    '/about/*',     // Hanya 1 segmen setelah /setting
    '/api'          // Hanya persis /dashboard
  ]
})
```

### Wildcard
`*` (satu bintang) → **hanya satu segmen path**
Contoh: 
```bash
/setting/* → match: /setting/user
             tidak match: /setting/user/angga
```
`**` (dua bintang) → **semua segmen setelahnya**
```bash
/user/** → match: /user
           match: /user/profile
           match: /user/profile/edit
```

Config Middleware juga bisa anda setting saat meregister ke dalam route, tetapi hanya `composeMiddleware` tidak dengan `autoComposeMiddleware` karna itu dah otomatis jadi global middleware.

Contoh:
```ts
// index.ts
defineBootstrap((app) => {
  app.mountMiddleware(AppMiddleware({
    priority: 'high',
    includes: ['/dashboard']
  }))
})
// AppRoutes.ts
composeRoutes((route) => {
  route.get('/', Handler).middleware(AppMiddleware({
    excludes: ['/api/**']
  }))
})
```

